{"version":3,"sources":["../webpack/bootstrap","../external \"vscode\"",".././src/models.ts",".././src/history.ts",".././src/extension.ts",".././src/editorHighlights.ts",".././src/provider.ts"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","require","getRequestRange","doc","pos","range","getWordRangeAtPosition","getPreviewChunks","beforeLen","trim","previewStart","start","with","character","Math","max","wordRange","before","getText","vscode","Range","inside","previewEnd","end","translate","after","replace","Context","commands","executeCommand","this","IsActive","Source","HasResult","HasHistory","CallHierarchyMode","FileItem","uri","results","parent","ReferenceItem","location","warmUpNext","_document","workspace","openTextDocument","item","move","then","getDocument","ReferencesModel","source","position","locations","_onDidChange","EventEmitter","onDidChange","event","items","last","sort","_compareLocations","loc","Location","targetUri","targetRange","_compareUriIgnoreFragment","fragment","push","Promise","resolve","args","e","String","fromCharCode","preview","HistoryItem","makeId","asRelativePath","WordAnchor","length","toString","ref","contains","lastBefore","isAfter","best","bestValue","_prefixLen","_del","fire","fwd","delta","_move","idx","indexOf","_tail","a","b","aStr","bStr","aUri","bUri","aRange","bRange","isBefore","charCodeAt","array","splice","RichCallsDirection","_mem","_value","raw","_key","set","update","CallItem","CallsModel","direction","roots","map","undefined","calls","from","fromRanges","to","first","selectionRange","line","_doc","_position","_version","version","_word","_getAnchorWord","wordNow","startLine","checked","lineCount","ch","lineAt","text","Position","id","label","description","commandId","extraArgs","anchor","str","JSON","stringify","Buffer","History","_items","Map","size","iterator","values","delete","clear","context","callsDirection","globalState","history","provider","TreeDataProviderWrapper","viewId","view","window","createTreeView","treeDataProvider","showCollapseAll","editorHighlights","EditorHighlights","model","onDidChangeActiveTextEditor","visible","show","subscriptions","onDidChangeVisibility","hide","updateModel","async","newModel","message","setModel","Boolean","revealView","showResultsMessage","showNoResultsMessage","isEmpty","title","total","files","updateReferencesModel","selection","reveal","select","focus","add","asHistoryItem","findReferencesCommand","Uri","activeTextEditor","editor","document","active","refindCommand","getPosition","updateCallHierachyModel","expand","setCallHierarchyDirectionCommand","arg","showItemCommand","focusEditor","preserveFocus","focusRefCommand","next","copyCommand","val","stack","pop","slice","chunks","env","clipboard","writeText","showReferences","showReferencesDisposable","config","updateShowReferences","affectsConfiguration","getConfiguration","dispose","registerCommand","onDidChangeConfiguration","remove","refresh","scheme","fsPath","picks","pick","showQuickPick","placeHolder","_view","_decorationType","createTextEditorDecorationType","backgroundColor","ThemeColor","rangeBehavior","DecorationRangeBehavior","ClosedClosed","overviewRulerLane","OverviewRulerLane","Center","overviewRulerColor","_ignore","Set","_model","_listener","onDidChangeTextDocument","onDidChangeSelection","viewColumn","ranges","has","sel","setDecorations","visibleTextEditors","ReferencesProvider","_onDidChangeTreeData","onDidChangeTreeData","_modelListener","element","result","TreeItem","contextValue","iconPath","ThemeIcon","File","collapsibleState","TreeItemCollapsibleState","Collapsed","highlights","TreeItem2","None","command","arguments","CallItemDataProvider","_emitter","detail","_getThemeIcon","kind","resolveCalls","_themeIconIds","HistoryDataProvider","_history","_providerListener","_provider","getTreeItem","getChildren","getParent"],"mappings":"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","file":"extension.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 3);\n","module.exports = require(\"vscode\");","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as vscode from 'vscode';\nimport { HistoryItem, WordAnchor } from './history';\n\n\nexport function getRequestRange(doc: vscode.TextDocument, pos: vscode.Position): vscode.Range | undefined {\n    let range = doc.getWordRangeAtPosition(pos);\n    if (!range) {\n        range = doc.getWordRangeAtPosition(pos, /[^\\s]+/);\n    }\n    return range;\n}\n\nexport function getPreviewChunks(doc: vscode.TextDocument, range: vscode.Range, beforeLen: number = 8, trim: boolean = true) {\n    let previewStart = range.start.with({ character: Math.max(0, range.start.character - beforeLen) });\n    let wordRange = doc.getWordRangeAtPosition(previewStart);\n    let before = doc.getText(new vscode.Range(wordRange ? wordRange.start : previewStart, range.start));\n    let inside = doc.getText(range);\n    let previewEnd = range.end.translate(0, 331);\n    let after = doc.getText(new vscode.Range(range.end, previewEnd));\n    if (trim) {\n        before = before.replace(/^\\s*/g, '');\n        after = after.replace(/\\s*$/g, '');\n    }\n    return { before, inside, after };\n}\n\nexport class Context<V> {\n\n    static IsActive = new Context<boolean>('reference-list.isActive');\n    static Source = new Context<ItemSource | 'callHierarchy' | undefined>('reference-list.source');\n    static HasResult = new Context<boolean>('reference-list.hasResult');\n    static HasHistory = new Context<boolean>('reference-list.hasHistory');\n    static CallHierarchyMode = new Context<'showOutgoing' | 'showIncoming'>('references-view.callHierarchyMode');\n\n    private constructor(readonly name: string) { }\n\n    async set(value: V) {\n        vscode.commands.executeCommand('setContext', this.name, value);\n    }\n}\n\nexport const enum ItemSource {\n    References = 'vscode.executeReferenceProvider',\n    Implementations = 'vscode.executeImplementationProvider',\n    CallHierarchy = 'vscode.prepareCallHierarchy'\n}\n\n\n//#region References Model\n\n\nexport class FileItem {\n\n    constructor(\n        readonly uri: vscode.Uri,\n        readonly results: Array<ReferenceItem>,\n        readonly parent: ReferencesModel\n    ) { }\n}\n\nexport class ReferenceItem {\n\n    private _document: Thenable<vscode.TextDocument> | undefined;\n\n    constructor(\n        readonly location: vscode.Location,\n        readonly parent: FileItem,\n    ) { }\n\n    async getDocument(warmUpNext?: boolean) {\n        if (!this._document) {\n            this._document = vscode.workspace.openTextDocument(this.location.uri);\n        }\n        if (warmUpNext) {\n            // load next document once this document has been loaded\n            // and when next document has not yet been loaded\n            const item = await this.parent.parent.move(this, true);\n            if (item && !item._document) {\n                this._document.then(() => item.getDocument(false));\n            }\n        }\n        return this._document;\n    }\n}\n\nexport class ReferencesModel {\n\n    static create(uri: vscode.Uri, position: vscode.Position, source: ItemSource): ReferencesModel {\n        const locations = Promise.resolve(vscode.commands.executeCommand<vscode.Location[]>(source, uri, position)).then(loc => loc ?? []);\n        return new ReferencesModel(source, uri, position, locations);\n    }\n\n    private readonly _onDidChange = new vscode.EventEmitter<ReferencesModel | FileItem>();\n    readonly onDidChange = this._onDidChange.event;\n\n    readonly items: Promise<FileItem[]>;\n\n    constructor(\n        readonly source: ItemSource,\n        readonly uri: vscode.Uri,\n        readonly position: vscode.Position,\n        locations: Promise<vscode.Location[] | vscode.LocationLink[]>\n    ) {\n        this.items = locations.then(locations => {\n            const items: FileItem[] = [];\n            let last: FileItem | undefined;\n            locations.sort(ReferencesModel._compareLocations);\n            for (const item of locations) {\n                const loc = item instanceof vscode.Location\n                    ? item\n                    : new vscode.Location(item.targetUri, item.targetRange);\n\n                if (!last || ReferencesModel._compareUriIgnoreFragment(last.uri, loc.uri) !== 0) {\n                    last = new FileItem(loc.uri.with({ fragment: '' }), [], this);\n                    items.push(last);\n                }\n                last.results.push(new ReferenceItem(loc, last));\n            }\n            return items;\n        });\n    }\n\n    async asHistoryItem(args: any[]) {\n        let doc: vscode.TextDocument;\n        try {\n            doc = await vscode.workspace.openTextDocument(this.uri);\n        } catch (e) {\n            return;\n        }\n        const range = getRequestRange(doc, this.position);\n        if (!range) {\n            return;\n        }\n        // make preview\n        let { before, inside, after } = getPreviewChunks(doc, range);\n        // ensure whitespace isn't trimmed when rendering MD\n        before = before.replace(/s$/g, String.fromCharCode(160));\n        after = after.replace(/^s/g, String.fromCharCode(160));\n        let preview = before + inside + after;\n\n        // source hint\n        let source = this.source === ItemSource.Implementations ? 'implementations' : 'references';\n\n        return new HistoryItem(\n            HistoryItem.makeId(this.source, this.uri, this.position),\n            inside,\n            `${vscode.workspace.asRelativePath(this.uri)} • ${preview} • ${source}`,\n            'references-view.refindReference',\n            args,\n            this.uri,\n            new WordAnchor(doc, this.position)\n        );\n    }\n\n    async total(): Promise<number> {\n        let n = 0;\n        for (const item of await this.items) {\n            n += item.results.length;\n        }\n        return n;\n    }\n\n    async get(uri: vscode.Uri): Promise<FileItem | undefined> {\n        for (const item of await this.items) {\n            if (item.uri.toString() === uri.toString()) {\n                return item;\n            }\n        }\n        return undefined;\n    }\n\n    async first(): Promise<ReferenceItem | undefined> {\n\n        const items = await this.items;\n\n        if (items.length === 0) {\n            return;\n        }\n        // NOTE: this.items is sorted by location (uri/range)\n        for (const item of items) {\n            if (item.uri.toString() === this.uri.toString()) {\n                // (1) pick the item at the request position\n                for (const ref of item.results) {\n                    if (ref.location.range.contains(this.position)) {\n                        return ref;\n                    }\n                }\n                // (2) pick the first item after or last before the request position\n                let lastBefore: ReferenceItem | undefined;\n                for (const ref of item.results) {\n                    if (ref.location.range.end.isAfter(this.position)) {\n                        return ref;\n                    }\n                    lastBefore = ref;\n                }\n                if (lastBefore) {\n                    return lastBefore;\n                }\n\n                break;\n            }\n        }\n\n        // (3) pick the file with the longest common prefix\n        let best = 0;\n        let bestValue = ReferencesModel._prefixLen(items[best].toString(), this.uri.toString());\n\n        for (let i = 1; i < items.length; i++) {\n            let value = ReferencesModel._prefixLen(items[i].uri.toString(), this.uri.toString());\n            if (value > bestValue) {\n                best = i;\n            }\n        }\n\n        return items[best].results[0];\n    }\n\n    async remove(item: FileItem | ReferenceItem): Promise<void> {\n\n        if (item instanceof FileItem) {\n            ReferencesModel._del(await this.items, item);\n            this._onDidChange.fire(this);\n\n        } else if (item instanceof ReferenceItem) {\n            ReferencesModel._del(item.parent.results, item);\n            if (item.parent.results.length === 0) {\n                ReferencesModel._del(await this.items, item.parent);\n                this._onDidChange.fire(this);\n            } else {\n                this._onDidChange.fire(item.parent);\n            }\n        }\n    }\n\n    async move(item: FileItem | ReferenceItem, fwd: boolean): Promise<ReferenceItem | undefined> {\n        const items = await this.items;\n        const delta = fwd ? +1 : -1;\n\n        const _move = (item: FileItem): FileItem => {\n            const idx = (items.indexOf(item) + delta + items.length) % items.length;\n            return items[idx];\n        };\n\n        if (item instanceof FileItem) {\n            if (fwd) {\n                return _move(item).results[0];\n            } else {\n                return ReferencesModel._tail(_move(item).results);\n            }\n        }\n\n        if (item instanceof ReferenceItem) {\n            const idx = item.parent.results.indexOf(item) + delta;\n            if (idx < 0) {\n                return ReferencesModel._tail(_move(item.parent).results);\n            } else if (idx >= item.parent.results.length) {\n                return _move(item.parent).results[0];\n            } else {\n                return item.parent.results[idx];\n            }\n        }\n    }\n\n    private static _compareUriIgnoreFragment(a: vscode.Uri, b: vscode.Uri): number {\n        let aStr = a.with({ fragment: '' }).toString();\n        let bStr = b.with({ fragment: '' }).toString();\n        if (aStr < bStr) {\n            return -1;\n        } else if (aStr > bStr) {\n            return 1;\n        }\n        return 0;\n    }\n\n    private static _compareLocations(a: vscode.Location | vscode.LocationLink, b: vscode.Location | vscode.LocationLink): number {\n        let aUri = a instanceof vscode.Location ? a.uri : a.targetUri;\n        let bUri = b instanceof vscode.Location ? b.uri : b.targetUri;\n        if (aUri.toString() < bUri.toString()) {\n            return -1;\n        } else if (aUri.toString() > bUri.toString()) {\n            return 1;\n        }\n\n        let aRange = a instanceof vscode.Location ? a.range : a.targetRange;\n        let bRange = b instanceof vscode.Location ? b.range : b.targetRange;\n        if (aRange.start.isBefore(bRange.start)) {\n            return -1;\n        } else if (aRange.start.isAfter(bRange.start)) {\n            return 1;\n        } else {\n            return 0;\n        }\n    }\n\n    private static _prefixLen(a: string, b: string): number {\n        let pos = 0;\n        while (pos < a.length && pos < b.length && a.charCodeAt(pos) === b.charCodeAt(pos)) {\n            pos += 1;\n        }\n        return pos;\n    }\n\n    private static _del<T>(array: T[], e: T): void {\n        const idx = array.indexOf(e);\n        if (idx >= 0) {\n            array.splice(idx, 1);\n        }\n    }\n\n    private static _tail<T>(array: T[]): T | undefined {\n        return array[array.length - 1];\n    }\n}\n\n\n//#endregion\n\n//#region CallHierarchy Model\n\nexport const enum CallsDirection {\n    Incoming,\n    Outgoing\n}\n\n\nexport class RichCallsDirection {\n\n    private static _key = 'references-view.callHierarchyMode';\n\n    constructor(\n        private _mem: vscode.Memento,\n        private _value: CallsDirection = CallsDirection.Outgoing,\n    ) {\n        const raw = _mem.get<number>(RichCallsDirection._key);\n        if (typeof raw === 'number' && raw >= 0 && raw <= 1) {\n            this.value = raw;\n        } else {\n            this.value = _value;\n        }\n    }\n\n    get value() {\n        return this._value;\n    }\n\n    set value(value: CallsDirection) {\n        this._value = value;\n        Context.CallHierarchyMode.set(this._value === CallsDirection.Incoming ? 'showIncoming' : 'showOutgoing');\n        this._mem.update(RichCallsDirection._key, value);\n    }\n}\n\nexport class CallItem {\n    constructor(\n        readonly item: vscode.CallHierarchyItem,\n        readonly parent: CallItem | undefined,\n        readonly locations: vscode.Location[] | undefined\n    ) { }\n}\n\nexport class CallsModel {\n\n    readonly source = 'callHierarchy';\n\n    readonly roots: Promise<CallItem[]>;\n\n    constructor(readonly uri: vscode.Uri, readonly position: vscode.Position, readonly direction: CallsDirection) {\n        this.roots = Promise.resolve(vscode.commands.executeCommand<vscode.CallHierarchyItem[]>('vscode.prepareCallHierarchy', uri, position)).then(items => {\n            return items ? items.map(item => new CallItem(item, undefined, undefined)) : [];\n        });\n    }\n\n    async resolveCalls(call: CallItem): Promise<CallItem[]> {\n        if (this.direction === CallsDirection.Incoming) {\n            const calls = await vscode.commands.executeCommand<vscode.CallHierarchyIncomingCall[]>('vscode.provideIncomingCalls', call.item);\n            return calls ? calls.map(item => new CallItem(item.from, call, item.fromRanges.map(range => new vscode.Location(item.from.uri, range)))) : [];\n        } else {\n            const calls = await vscode.commands.executeCommand<vscode.CallHierarchyOutgoingCall[]>('vscode.provideOutgoingCalls', call.item);\n            return calls ? calls.map(item => new CallItem(item.to, call, item.fromRanges.map(range => new vscode.Location(call.item.uri, range)))) : [];\n        }\n    }\n\n    changeDirection(): CallsModel {\n        return new CallsModel(this.uri, this.position, this.direction === CallsDirection.Incoming ? CallsDirection.Outgoing : CallsDirection.Incoming);\n    }\n\n    async isEmpty() {\n        return (await this.roots).length === 0;\n    }\n\n    async first() {\n        const [first] = await this.roots;\n        return first;\n    }\n\n    async asHistoryItem(args: any[]) {\n\n        const [first] = await this.roots;\n        const source = this.direction === CallsDirection.Incoming ? 'calls from' : 'callers of';\n\n\n        return new HistoryItem(\n            HistoryItem.makeId(first.item.uri, first.item.selectionRange.start.line, first.item.selectionRange.start.character, this.direction),\n            first.item.name,\n            `${vscode.workspace.asRelativePath(this.uri)} • ${source}`,\n            'references-view.showCallHierarchy',\n            args,\n            this.uri,\n            new WordAnchor(await vscode.workspace.openTextDocument(this.uri), this.position)\n        );\n    }\n}\n\n//#endregion\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as vscode from 'vscode';\nimport { Context } from './models';\n\nexport class WordAnchor {\n\n    private readonly _version: number;\n    private readonly _word: string | undefined;\n\n    constructor(private readonly _doc: vscode.TextDocument, private readonly _position: vscode.Position) {\n        this._version = _doc.version;\n        this._word = this._getAnchorWord(_doc, _position);\n    }\n\n    private _getAnchorWord(doc: vscode.TextDocument, pos: vscode.Position): string | undefined {\n        const range = doc.getWordRangeAtPosition(pos) || doc.getWordRangeAtPosition(pos, /[^\\s]+/);\n        return range && doc.getText(range);\n    }\n\n    getPosition(): vscode.Position | undefined {\n        // funky entry\n        if (!this._word) {\n            return this._position;\n        }\n\n        // no changes\n        if (this._version === this._doc.version) {\n            return this._position;\n        }\n\n        // no changes here...\n        const wordNow = this._getAnchorWord(this._doc, this._position);\n        if (this._word === wordNow) {\n            return this._position;\n        }\n\n        // changes: search _word downwards and upwards\n        const startLine = this._position.line;\n        let i = 0;\n        let line: number;\n        let checked: boolean;\n        do {\n            checked = false;\n            // nth line down\n            line = startLine + i;\n            if (line < this._doc.lineCount) {\n                checked = true;\n                let ch = this._doc.lineAt(line).text.indexOf(this._word);\n                if (ch >= 0) {\n                    return new vscode.Position(line, ch);\n                }\n            }\n            i += 1;\n            // nth line up\n            line = startLine - i;\n            if (line >= 0) {\n                checked = true;\n                let ch = this._doc.lineAt(line).text.indexOf(this._word);\n                if (ch >= 0) {\n                    return new vscode.Position(line, ch);\n                }\n            }\n        } while (i < 100 && checked);\n\n        // fallback\n        return this._position;\n    }\n}\n\nexport class HistoryItem {\n\n    static makeId(...args: any[]): string {\n        let str = '';\n        for (const a of args) {\n            str += JSON.stringify(a);\n        }\n        return Buffer.from(str).toString('base64');\n    }\n\n    constructor(\n        readonly id: string,\n        readonly label: string,\n        readonly description: string,\n        readonly commandId: string,\n        readonly extraArgs: string[],\n        readonly uri: vscode.Uri,\n        readonly anchor: WordAnchor,\n    ) { }\n}\n\nexport class History {\n\n    private readonly _items = new Map<string, HistoryItem>();\n\n    get isEmpty(): boolean {\n        return this._items.size == 0;\n    }\n\n    *[Symbol.iterator]() {\n        let values = [...this._items.values()];\n        for (let i = values.length - 1; i >= 0; i--) {\n            yield values[i];\n        }\n    }\n\n    add(item?: HistoryItem): void {\n        if (item) {\n            // maps have filo-ordering and by delete-insert we make\n            // sure to update the order for re-run queries\n            this._items.delete(item.id);\n            this._items.set(item.id, item);\n            Context.HasHistory.set(true);\n        }\n    }\n\n    get(id: string): HistoryItem | undefined {\n        return this._items.get(id);\n    }\n\n    clear(): void {\n        this._items.clear();\n        Context.HasHistory.set(false);\n    }\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as vscode from 'vscode';\nimport { EditorHighlights } from './editorHighlights';\nimport { History, HistoryItem } from './history';\nimport { CallItem, CallsDirection, CallsModel, Context, FileItem, getPreviewChunks, getRequestRange, ItemSource, ReferenceItem, ReferencesModel, RichCallsDirection } from './models';\nimport { TreeDataProviderWrapper, TreeItem } from './provider';\n\nexport function activate(context: vscode.ExtensionContext) {\n\n    const callsDirection = new RichCallsDirection(context.globalState);\n    const history = new History();\n    const provider = new TreeDataProviderWrapper<TreeItem>();\n\n    const viewId = 'references-view.tree';\n\n    const revealView = async () => {\n        // upon first interaction set the reference list as active and reveal it\n        await Context.IsActive.set(true);\n        await vscode.commands.executeCommand(`${viewId}.focus`);\n    };\n\n    const view = vscode.window.createTreeView<FileItem | ReferenceItem | CallItem>(viewId, {\n        treeDataProvider: provider,\n        showCollapseAll: true\n    });\n\n    // editor highlights\n    const editorHighlights = new EditorHighlights(view);\n    vscode.window.onDidChangeActiveTextEditor(() => view.visible && editorHighlights.show(), undefined, context.subscriptions);\n    view.onDidChangeVisibility(e => e.visible ? editorHighlights.show() : editorHighlights.hide(), undefined, context.subscriptions);\n\n    // current active model\n    let model: ReferencesModel | CallsModel | undefined;\n\n    const updateModel = async (newModel: ReferencesModel | CallsModel | undefined) => {\n        model = newModel;\n\n        // update state\n        view.message = undefined;\n        editorHighlights.setModel(model);\n\n        // update context\n        Context.HasResult.set(Boolean(model));\n        Context.Source.set(model?.source);\n\n        revealView();\n        provider.update(newModel || history);\n\n        if (newModel) {\n            await showResultsMessage();\n        } else {\n            showNoResultsMessage();\n        }\n    };\n\n    const showNoResultsMessage = () => {\n        let message: string;\n        if (history.isEmpty) {\n            message = 'No results.';\n        } else {\n            message = 'No results. Try running a previous search again:';\n        }\n        view.message = message;\n        view.title = 'Results';\n    };\n\n    const showResultsMessage = async () => {\n        if (model instanceof ReferencesModel) {\n\n            const total = await model.total();\n            const files = (await model.items).length;\n\n            // update message\n            if (total === 1 && files === 1) {\n                view.message = `${total} result in ${files} file`;\n            } else if (total === 1) {\n                view.message = `${total} result in ${files} files`;\n            } else if (files === 1) {\n                view.message = `${total} results in ${files} file`;\n            } else {\n                view.message = `${total} results in ${files} files`;\n            }\n\n            // update title\n            if (model.source === ItemSource.References) {\n                view.title = `Results (${total})`;\n            } else if (model.source === ItemSource.Implementations) {\n                view.title = `Implementations (${total})`;\n            }\n\n        } else if (model instanceof CallsModel) {\n            // update title\n            if (model.direction === CallsDirection.Incoming) {\n                view.title = 'Callers Of';\n            } else {\n                view.title = 'Calls From';\n            }\n            view.message = '';\n\n        } else {\n            view.message = undefined;\n            view.title = 'Results';\n        }\n    };\n\n    const updateReferencesModel = async (model?: ReferencesModel) => {\n\n        // wait for model, update context and UI\n        await updateModel(model);\n\n        if (model) {\n            // bail out when having no results...\n            if ((await model.items).length === 0) {\n                await updateModel(undefined);\n                return;\n            }\n            // reveal\n            const selection = await model.first();\n            if (selection && view.visible) {\n                view.reveal(selection, { select: true, focus: true });\n            }\n            // add to history\n            history.add(await model.asHistoryItem([model.source]));\n        }\n    };\n\n    const findReferencesCommand = async (source: ItemSource, uri?: vscode.Uri, position?: vscode.Position) => {\n        let model: ReferencesModel | undefined;\n        if (uri instanceof vscode.Uri && position instanceof vscode.Position) {\n            // trust args if correct'ish\n            model = ReferencesModel.create(uri, position, source);\n\n        } else if (vscode.window.activeTextEditor) {\n            // take args from active editor\n            let editor = vscode.window.activeTextEditor;\n            if (getRequestRange(editor.document, editor.selection.active)) {\n                model = ReferencesModel.create(editor.document.uri, editor.selection.active, source);\n            }\n        }\n        updateReferencesModel(model);\n    };\n\n    const refindCommand = (item: HistoryItem) => {\n        if (item instanceof HistoryItem) {\n            vscode.commands.executeCommand(item.commandId, ...[...item.extraArgs, item.uri, item.anchor.getPosition()]);\n        }\n    };\n\n    const refreshCommand = async () => {\n        const [last] = history;\n        if (last) {\n            refindCommand(last);\n        }\n    };\n\n    const updateCallHierachyModel = async (direction = callsDirection.value, uri?: vscode.Uri, position?: vscode.Position) => {\n\n        let model: CallsModel | undefined;\n\n        if (uri instanceof vscode.Uri && position instanceof vscode.Position) {\n            // trust args if correct'ish\n            model = new CallsModel(uri, position, direction);\n\n        } else if (vscode.window.activeTextEditor) {\n            // take args from active editor\n            let editor = vscode.window.activeTextEditor;\n            if (getRequestRange(editor.document, editor.selection.active)) {\n                model = new CallsModel(editor.document.uri, editor.selection.active, direction);\n            }\n        }\n\n        await updateModel(model);\n\n        if (model instanceof CallsModel) {\n            if (await model.isEmpty()) {\n                await updateModel(undefined);\n                return;\n            }\n            // reveal\n            const selection = await model.first();\n            if (selection && view.visible) {\n                view.reveal(selection, { select: true, focus: true, expand: true });\n            }\n            // add to history\n            history.add(await model.asHistoryItem([model.direction]));\n        }\n    };\n\n    const setCallHierarchyDirectionCommand = async (direction: CallsDirection, arg: any) => {\n        callsDirection.value = direction;\n        if (arg instanceof CallItem) {\n            return updateCallHierachyModel(direction, arg.item.uri, arg.item.selectionRange.start);\n\n        } else if (model instanceof CallsModel) {\n            return updateCallHierachyModel(direction, model.uri, model.position);\n        }\n    };\n\n    const clearCommand = async () => {\n        await updateModel(undefined);\n    };\n\n    const clearHistoryCommand = async () => {\n        history.clear();\n        await updateModel(undefined);\n    };\n\n    const showItemCommand = (arg?: ReferenceItem | HistoryItem | CallItem | any, focusEditor?: boolean) => {\n\n        let uri: vscode.Uri | undefined;\n        let pos: vscode.Position | undefined;\n        let preserveFocus = !focusEditor;\n\n        if (arg instanceof ReferenceItem) {\n            const { location } = arg;\n            uri = location.uri;\n            pos = location.range.start;\n\n        } else if (arg instanceof CallItem) {\n            uri = arg.item.uri;\n            pos = arg.item.selectionRange.start;\n\n        } else if (arg instanceof HistoryItem) {\n            uri = arg.uri;\n            pos = arg.anchor.getPosition();\n            preserveFocus = false;\n        }\n\n        if (uri && pos) {\n            return vscode.commands.executeCommand('vscode.open', uri, {\n                selection: new vscode.Range(pos, pos),\n                preserveFocus\n            });\n        }\n    };\n\n    const removeRefCommand = async (arg?: ReferenceItem | FileItem | any) => {\n        if (model instanceof ReferencesModel) {\n            let next: ReferenceItem | undefined;\n            if (arg instanceof ReferenceItem) {\n                next = await model.move(arg, true);\n                if (next?.parent !== arg.parent) {\n                    next = undefined;\n                }\n            }\n            await model.remove(arg);\n            editorHighlights.refresh();\n            showResultsMessage();\n            if (next) {\n                view.reveal(next, { select: true });\n            }\n        }\n    };\n\n    const focusRefCommand = async (fwd: boolean) => {\n        if (!(model instanceof ReferencesModel)) {\n            return;\n        }\n        const selection = view.selection[0] || model.first();\n        if (selection instanceof HistoryItem || selection instanceof CallItem) {\n            return;\n        }\n        const next = await model.move(selection, fwd);\n        if (next) {\n            view.reveal(next, { select: true });\n            showItemCommand(next, true);\n        }\n    };\n\n    const copyCommand = async (arg?: ReferenceItem | FileItem | ReferencesModel | any | undefined) => {\n        let val = '';\n        let stack = [arg];\n        while (stack.length > 0) {\n            let item = stack.pop();\n            if (item instanceof ReferencesModel) {\n                stack.push(...(await item.items).slice(0, 99));\n\n            } else if (item instanceof ReferenceItem) {\n                let doc = await item.getDocument();\n                let chunks = getPreviewChunks(doc, item.location.range, 21, false);\n                val += `  ${item.location.range.start.line + 1}, ${item.location.range.start.character + 1}: ${chunks.before + chunks.inside + chunks.after} \\n`;\n\n            } else if (item instanceof FileItem) {\n                val += `${vscode.workspace.asRelativePath(item.uri)} \\n`;\n                stack.push(...item.results);\n            }\n        }\n        if (val) {\n            await vscode.env.clipboard.writeText(val);\n        }\n    };\n\n    const copyPathCommand = (arg?: FileItem) => {\n        if (arg instanceof FileItem) {\n            if (arg.uri.scheme === 'file') {\n                vscode.env.clipboard.writeText(arg.uri.fsPath);\n            } else {\n                vscode.env.clipboard.writeText(arg.uri.toString(true));\n            }\n        }\n    };\n\n    const showHistryPicks = async () => {\n        interface HistoryPick extends vscode.QuickPickItem {\n            item: HistoryItem;\n        }\n        const picks = [...history].map(item => <HistoryPick>{\n            label: item.label,\n            description: item.description,\n            item\n        });\n        const pick = await vscode.window.showQuickPick(picks, { placeHolder: 'Select previous reference search' });\n        if (pick) {\n            await refindCommand(pick.item);\n        }\n    };\n\n    const showReferences = async (uri: vscode.Uri, position: vscode.Position, locations: vscode.Location[]) => {\n        await updateReferencesModel(new ReferencesModel(ItemSource.References, uri, position, Promise.resolve(locations)));\n    };\n    let showReferencesDisposable: vscode.Disposable | undefined;\n    const config = 'references.preferredLocation';\n    function updateShowReferences(event?: vscode.ConfigurationChangeEvent) {\n        if (event && !event.affectsConfiguration(config)) {\n            return;\n        }\n        const value = vscode.workspace.getConfiguration().get<string>(config);\n        if (showReferencesDisposable) {\n            showReferencesDisposable.dispose();\n            showReferencesDisposable = undefined;\n        }\n        if (value === 'view') {\n            showReferencesDisposable = vscode.commands.registerCommand('editor.action.showReferences', showReferences);\n        }\n    };\n    updateShowReferences();\n\n    context.subscriptions.push(\n        view,\n        vscode.workspace.onDidChangeConfiguration(updateShowReferences),\n        vscode.commands.registerCommand('references-view.find', () => findReferencesCommand(ItemSource.References)),\n        vscode.commands.registerCommand('references-view.findImplementations', () => findReferencesCommand(ItemSource.Implementations)),\n        vscode.commands.registerCommand('references-view.refindReference', findReferencesCommand),\n        vscode.commands.registerCommand('references-view.showCallHierarchy', () => updateCallHierachyModel()),\n        vscode.commands.registerCommand('references-view.showOutgoingCalls', (arg) => setCallHierarchyDirectionCommand(CallsDirection.Outgoing, arg)),\n        vscode.commands.registerCommand('references-view.showIncomingCalls', (arg) => setCallHierarchyDirectionCommand(CallsDirection.Incoming, arg)),\n        vscode.commands.registerCommand('references-view.refind', refindCommand),\n        vscode.commands.registerCommand('references-view.refresh', refreshCommand),\n        vscode.commands.registerCommand('references-view.clear', clearCommand),\n        vscode.commands.registerCommand('references-view.clearHistory', clearHistoryCommand),\n        vscode.commands.registerCommand('references-view.show', showItemCommand),\n        vscode.commands.registerCommand('references-view.remove', removeRefCommand),\n        vscode.commands.registerCommand('references-view.next', () => focusRefCommand(true)),\n        vscode.commands.registerCommand('references-view.prev', () => focusRefCommand(false)),\n        vscode.commands.registerCommand('references-view.copy', copyCommand),\n        vscode.commands.registerCommand('references-view.copyAll', () => copyCommand(model)),\n        vscode.commands.registerCommand('references-view.copyPath', copyPathCommand),\n        vscode.commands.registerCommand('references-view.pickFromHistory', showHistryPicks),\n    );\n\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as vscode from 'vscode';\nimport { CallItem, CallsModel, FileItem, ReferencesModel } from './models';\nimport { TreeItem } from './provider';\n\nexport class EditorHighlights {\n\n    private readonly _decorationType = vscode.window.createTextEditorDecorationType({\n        backgroundColor: new vscode.ThemeColor('editor.findMatchHighlightBackground'),\n        rangeBehavior: vscode.DecorationRangeBehavior.ClosedClosed,\n        overviewRulerLane: vscode.OverviewRulerLane.Center,\n        overviewRulerColor: new vscode.ThemeColor('editor.findMatchHighlightBackground'),\n    });\n\n    private _model?: ReferencesModel | CallsModel;\n    private _listener?: vscode.Disposable;\n    private _ignore = new Set<FileItem | undefined>();\n\n    constructor(private readonly _view: vscode.TreeView<TreeItem>) { }\n\n    setModel(model?: ReferencesModel | CallsModel): void {\n        this._model = model;\n        this._ignore.clear();\n        if (this._listener) {\n            this._listener.dispose();\n        }\n\n        if (model instanceof ReferencesModel) {\n            this._listener = vscode.workspace.onDidChangeTextDocument(async e => {\n                // add those items that have been changed to a \n                // ignore list so that we won't update decorations\n                // for them again\n                this._ignore.add(await model.get(e.document.uri));\n            });\n\n        } else if (model instanceof CallsModel) {\n            this._listener = this._view.onDidChangeSelection(() => {\n                this.show();\n            });\n        }\n\n        this.show();\n    }\n\n    async show() {\n        const { activeTextEditor: editor } = vscode.window;\n        if (editor && editor.viewColumn) {\n            const ranges: vscode.Range[] = [];\n            if (this._model instanceof ReferencesModel) {\n                const item = await this._model.get(editor.document.uri);\n                if (item && !this._ignore.has(item)) {\n                    ranges.push(...item.results.map(ref => ref.location.range));\n                }\n            } else if (this._model instanceof CallsModel) {\n                const [sel] = this._view.selection;\n                if (sel instanceof CallItem) {\n                    let locations = sel.locations;\n                    if (!locations) {\n                        locations = [new vscode.Location(sel.item.uri, sel.item.selectionRange)];\n                    }\n                    for (const loc of locations) {\n                        if (loc.uri.toString() === editor.document.uri.toString()) {\n                            ranges.push(loc.range);\n                        }\n                    }\n                }\n            }\n            editor.setDecorations(this._decorationType, ranges);\n        }\n    }\n\n    hide() {\n        for (const editor of vscode.window.visibleTextEditors) {\n            editor.setDecorations(this._decorationType, []);\n        }\n    }\n\n    refresh() {\n        this.hide();\n        this.show();\n    }\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as vscode from 'vscode';\nimport { History, HistoryItem } from './history';\nimport { CallItem as CallHierarchyItem, CallsModel, FileItem, getPreviewChunks, ReferenceItem, ReferencesModel } from './models';\n\nexport class ReferencesProvider implements vscode.TreeDataProvider<FileItem | ReferenceItem> {\n\n    private readonly _onDidChangeTreeData = new vscode.EventEmitter<FileItem | ReferenceItem>();\n    readonly onDidChangeTreeData = this._onDidChangeTreeData.event;\n\n    private readonly _modelListener: vscode.Disposable;\n\n    constructor(\n        private _model: ReferencesModel\n    ) {\n        this._modelListener = _model.onDidChange(e => this._onDidChangeTreeData.fire(e instanceof FileItem ? e : undefined));\n    }\n\n    dispose(): void {\n        this._onDidChangeTreeData.dispose();\n        this._modelListener.dispose();\n    }\n\n    async getTreeItem(element: FileItem | ReferenceItem): Promise<vscode.TreeItem> {\n\n        if (element instanceof FileItem) {\n            // files\n            const result = new vscode.TreeItem(element.uri);\n            result.contextValue = 'file-item';\n            result.description = true;\n            result.iconPath = vscode.ThemeIcon.File;\n            result.collapsibleState = vscode.TreeItemCollapsibleState.Collapsed;\n            return result;\n\n        } else {\n            // references\n            const { range } = element.location;\n            const doc = await element.getDocument(true);\n            const { before, inside, after } = getPreviewChunks(doc, range);\n\n            const label: vscode.TreeItemLabel = {\n                label: before + inside + after,\n                highlights: [[before.length, before.length + inside.length]]\n            };\n\n            const result = new vscode.TreeItem2(label);\n            result.collapsibleState = vscode.TreeItemCollapsibleState.None;\n            result.contextValue = 'reference-item';\n            result.command = { command: 'references-view.show', title: 'Open Reference', arguments: [element] };\n            return result;\n        }\n    }\n\n    async getChildren(element?: FileItem | ReferenceItem | undefined) {\n        if (!element) {\n            // group results by FileItem\n            return this._model.items;\n        } else if (element instanceof FileItem) {\n            // matches inside a file\n            return element.results;\n        }\n    }\n\n    getParent(element: FileItem | ReferenceItem) {\n        return element instanceof ReferenceItem ? element.parent : undefined;\n    }\n}\n\nexport class CallItemDataProvider implements vscode.TreeDataProvider<CallHierarchyItem> {\n\n    private readonly _emitter = new vscode.EventEmitter<CallHierarchyItem | undefined>();\n    readonly onDidChangeTreeData = this._emitter.event;\n\n    constructor(\n        private _model: CallsModel\n    ) { }\n\n    getTreeItem(element: CallHierarchyItem): vscode.TreeItem {\n\n        const item = new vscode.TreeItem(element.item.name);\n        item.description = element.item.detail;\n        item.contextValue = 'call-item';\n        item.iconPath = CallItemDataProvider._getThemeIcon(element.item.kind);\n        item.command = { command: 'references-view.show', title: 'Open Call', arguments: [element] };\n        item.collapsibleState = vscode.TreeItemCollapsibleState.Collapsed;\n        return item;\n    }\n\n    getChildren(element?: CallHierarchyItem | undefined) {\n        if (!element) {\n            return this._model.roots;\n        } else {\n            return this._model.resolveCalls(element);\n        }\n    }\n\n    getParent(element: CallHierarchyItem) {\n        return element.parent;\n    }\n\n    // vscode.SymbolKind.File === 0, Module === 1, etc...\n    private static _themeIconIds = [\n        'symbol-file', 'symbol-module', 'symbol-namespace', 'symbol-package', 'symbol-class', 'symbol-method',\n        'symbol-property', 'symbol-field', 'symbol-constructor', 'symbol-enum', 'symbol-interface',\n        'symbol-function', 'symbol-variable', 'symbol-constant', 'symbol-string', 'symbol-number', 'symbol-boolean',\n        'symbol-array', 'symbol-object', 'symbol-key', 'symbol-null', 'symbol-enum-member', 'symbol-struct',\n        'symbol-event', 'symbol-operator', 'symbol-type-parameter'\n    ];\n\n    private static _getThemeIcon(kind: vscode.SymbolKind): vscode.ThemeIcon | undefined {\n        let id = CallItemDataProvider._themeIconIds[kind];\n        return id && new vscode.ThemeIcon(id);\n    }\n}\n\nexport class HistoryDataProvider implements vscode.TreeDataProvider<HistoryItem> {\n\n    private readonly _emitter = new vscode.EventEmitter<HistoryItem | undefined>();\n    readonly onDidChangeTreeData = this._emitter.event;\n\n    constructor(private readonly _history: History) { }\n\n    getTreeItem(element: HistoryItem): vscode.TreeItem {\n        // history items\n        // let source: string | undefined;\n        // if (element.source === ItemSource.References) {\n        //     source = 'references';\n        // } else if (element.source === ItemSource.Implementations) {\n        //     source = 'implementations';\n        // } else if (element.source === ItemSource.CallHierarchy) {\n        //     source = 'call hierarchy';\n        // }\n        const result = new vscode.TreeItem(element.label);\n        // result.description = `${vscode.workspace.asRelativePath(element.uri)} • ${element.line} ${source && ` • ${source}`}`;\n        result.description = element.description;\n        result.command = { command: 'references-view.show', arguments: [element], title: 'Show' };\n        result.collapsibleState = vscode.TreeItemCollapsibleState.None;\n        result.contextValue = 'history-item';\n        return result;\n    }\n\n    getChildren() {\n        return [...this._history];\n    }\n\n    getParent() {\n        return undefined;\n    }\n}\n\n\nexport type TreeItem = FileItem | ReferenceItem | HistoryItem | CallHierarchyItem;\n\nexport class TreeDataProviderWrapper<T> implements vscode.TreeDataProvider<T> {\n\n    private _provider?: Required<vscode.TreeDataProvider<any>>;\n    private _providerListener?: vscode.Disposable;\n    private _onDidChange = new vscode.EventEmitter<any>();\n\n    readonly onDidChangeTreeData = this._onDidChange.event;\n\n    update(model: ReferencesModel | CallsModel | History) {\n        if (this._providerListener) {\n            this._providerListener.dispose();\n            this._providerListener = undefined;\n        }\n\n        if (this._provider && typeof (<vscode.Disposable><any>this._provider).dispose === 'function') {\n            (<vscode.Disposable><any>this._provider).dispose();\n            this._provider = undefined;\n        }\n\n        if (model instanceof ReferencesModel) {\n            this._provider = new ReferencesProvider(model);\n        } else if (model instanceof CallsModel) {\n            this._provider = new CallItemDataProvider(model);\n        } else {\n            this._provider = new HistoryDataProvider(model);\n        }\n\n        this._onDidChange.fire();\n        this._providerListener = this._provider.onDidChangeTreeData(e => this._onDidChange.fire(e));\n    }\n\n    getTreeItem(element: T): vscode.TreeItem | Thenable<vscode.TreeItem> {\n        return this._provider!.getTreeItem(element);\n    }\n\n    getChildren(element?: T | undefined) {\n        return this._provider?.getChildren(element);\n    }\n\n    getParent(element: T) {\n        return this._provider?.getParent(element);\n    }\n}\n"],"sourceRoot":""}